<!DOCTYPE html>
<html>
<head>
    <title>Barcode Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga/dist/quagga.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <h1>Barcode Scanner</h1>
    
    <!-- File input for uploading the .csv file -->
    <input type="file" id="csvFile" accept=".csv" />
    
    <!-- Button to start scanning -->
    <button id="startScan">Start Scan</button>
    
    <!-- Display the scanned barcode result -->
    <div id="result"></div>
    
    <!-- Container for the barcode scanner video feed -->
    <div id="scanner-container"></div>

    <!-- List of accepted barcodes -->
    <h2>Accepted Barcodes</h2>
    <ul id="acceptedBarcodes"></ul>

    <script>
        // Initialize file input
        const csvFileInput = document.getElementById('csvFile');
        const acceptedBarcodesList = document.getElementById('acceptedBarcodes');
        
        // Initialize the result display div
        const resultDiv = document.getElementById('result');
        
        // Initialize QuaggaJS for barcode scanning when the "Start Scan" button is clicked
        document.getElementById('startScan').addEventListener('click', function() {
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-container'),
                    constraints: {
                        facingMode: "environment",
                    },
                },
                decoder: {
                    readers: ["code_39_reader"],
                },
            }, function(err) {
                if (err) {
                    console.error(err);
                    alert('Error initializing barcode scanner.');
                    return;
                }
                Quagga.start();
                Quagga.onDetected(function(result) {
                    const scannedBarcode = result.codeResult.code;
                    resultDiv.innerText = `Scanned Barcode: ${scannedBarcode}`;
                    compareBarcodes(scannedBarcode);
                });
            });
        });

        // Function to handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Read the uploaded .csv file
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Parse the .csv data
                    const csvData = e.target.result;
                    updateAcceptedBarcodes(csvData);
                };
                reader.readAsText(file);
            }
        }

        // Function to update the list of accepted barcodes
        function updateAcceptedBarcodes(csvData) {
            acceptedBarcodesList.innerHTML = ''; // Clear the list
            const lines = csvData.split('\n');
            for (let i = 0; i < lines.length; i++) {
                const row = lines[i].trim();
                if (row !== '') {
                    const listItem = document.createElement('li');
                    listItem.innerText = row;
                    acceptedBarcodesList.appendChild(listItem);
                }
            }
        }

        // Function to compare scanned barcode with .csv data
        function compareBarcodes(scannedBarcode) {
            const acceptedBarcodes = Array.from(acceptedBarcodesList.children).map(item => item.innerText);
            
            if (acceptedBarcodes.includes(scannedBarcode)) {
                resultDiv.innerText = `Scanned Barcode: ${scannedBarcode} - Match found in accepted barcodes.`;
            } else {
                resultDiv.innerText = `Scanned Barcode: ${scannedBarcode} - No match found in accepted barcodes.`;
            }
        }

        // Listen for file input change event
        csvFileInput.addEventListener('change', handleFileUpload);
    </script>
</body>
</html>
